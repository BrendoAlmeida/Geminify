<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geminify ¬∑ AI Playlist Curator</title>
    <link rel="stylesheet" href="/styles.css" />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <canvas id="background" aria-hidden="true"></canvas>
    <div
      class="language-switcher"
      role="group"
      aria-label="Language selector"
      data-i18n-aria-label="lang.selector"
    >
      <span class="sr-only" data-i18n="lang.selector">Language selector</span>
      <span class="language-switcher__icon" aria-hidden="true">üåê</span>
      <button
        type="button"
        class="language-switcher__option is-active"
        data-lang="en"
        data-i18n-title="lang.option.enFull"
        title="English"
      >
        EN
      </button>
      <button
        type="button"
        class="language-switcher__option"
        data-lang="pt-BR"
        data-i18n-title="lang.option.ptFull"
        title="Portugu√™s (Brasil)"
      >
        PT-BR
      </button>
    </div>
    <div class="page-shell">
      <nav
        class="view-nav"
        aria-label="Toggle creation mode"
        data-i18n-aria-label="nav.aria"
      >
        <button class="view-nav__button is-active" type="button" data-view-target="playlists">
          <span class="view-nav__label" data-i18n="nav.playlists.title">Playlist generator</span>
          <span class="view-nav__hint" data-i18n="nav.playlists.hint">Create or enhance playlists with Gemini + Spotify</span>
        </button>
        <button class="view-nav__button" type="button" data-view-target="chat">
          <span class="view-nav__label" data-i18n="nav.chat.title">Idea lounge</span>
          <span class="view-nav__hint" data-i18n="nav.chat.hint">Chat with the model and capture tags</span>
        </button>
      </nav>

      <div id="playlistsView" class="view view--active" role="region" aria-labelledby="playlistsViewTitle">
        <header class="hero">
          <div class="hero__content">
            <h1 class="hero__title" id="playlistsViewTitle" data-i18n="hero.playlists.title">Craft soundscapes with AI + Spotify</h1>
            <p class="hero__subtitle" data-i18n="hero.playlists.subtitle">
              Spin up immersive playlists with a tap or describe the vibe and let Gemini curate a bespoke playlist in seconds.
            </p>
            <div class="hero__actions">
              <a class="btn btn--primary" href="/login" id="loginButton" data-i18n="hero.playlists.login">Log in with Spotify</a>
              <button class="btn btn--ghost" id="previewButton" data-i18n="hero.playlists.preview">Generate Random Playlists</button>
              <a
                class="btn btn--github"
                href="https://github.com/BrendoAlmeida/Geminify"
                target="_blank"
                rel="noopener noreferrer"
                data-i18n-title="hero.playlists.githubTitle"
                title="Star Geminify on GitHub"
              >
                <svg
                  class="btn__icon"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  aria-hidden="true"
                >
                  <path
                    d="M12 2C6.48 2 2 6.58 2 12.17c0 4.47 2.87 8.26 6.84 9.61.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.62-3.37-1.37-3.37-1.37-.45-1.18-1.1-1.49-1.1-1.49-.9-.63.07-.62.07-.62 1 .07 1.53 1.05 1.53 1.05.89 1.55 2.34 1.1 2.91.84.09-.66.35-1.1.63-1.35-2.22-.26-4.55-1.13-4.55-5.05 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.31.1-2.72 0 0 .84-.27 2.75 1.05a9.33 9.33 0 0 1 5 0c1.9-1.32 2.74-1.05 2.74-1.05.55 1.41.2 2.46.1 2.72.64.72 1.03 1.63 1.03 2.75 0 3.93-2.34 4.79-4.57 5.04.36.32.68.94.68 1.91 0 1.38-.01 2.49-.01 2.83 0 .26.18.58.69.48A10.02 10.02 0 0 0 22 12.17C22 6.58 17.52 2 12 2Z"
                    fill="currentColor"
                  />
                </svg>
                <span data-i18n="hero.playlists.githubLabel">Star us on GitHub</span>
              </a>
            </div>
            <p class="hero__github-note" data-i18n="hero.playlists.githubNote">Enjoying Geminify? Drop a ‚≠ê on GitHub to support the project.</p>
          </div>
        </header>

        <main class="content">
          <section class="panel panel--glass" aria-labelledby="customPromptTitle">
            <div class="panel__header">
              <h2 class="panel__title" id="customPromptTitle" data-i18n="custom.title">Dream up a custom playlist</h2>
              <p class="panel__description" data-i18n="custom.description">
                Describe a mood, scene, story, or genre-bending idea. Gemini will weave 20+ tracks into a cohesive playlist, then we push it straight to your Spotify.
              </p>
            </div>
            <div class="model-bar" aria-live="polite">
              <div class="model-bar__top">
                <label class="model-bar__label" for="modelSelect" data-i18n="models.label">Gemini model</label>
                <button type="button" class="btn btn--ghost btn--compact" id="refreshModels" data-i18n="models.refresh">Refresh</button>
              </div>
              <select id="modelSelect" class="model-bar__select" disabled>
                <option data-i18n="models.loading">Loading models‚Ä¶</option>
              </select>
              <p id="modelStatus" class="model-bar__status" data-i18n="models.status.connecting">Connecting to Gemini‚Ä¶</p>
            </div>
            <form id="customForm" class="prompt-form">
              <textarea
                id="customPrompt"
                name="prompt"
                rows="4"
                placeholder="e.g. A neon-lit midnight drive through Tokyo blending synthwave, future funk, and vapor soul"
                data-i18n-placeholder="forms.custom.placeholder"
                required
              ></textarea>
              <div class="playlist-upgrade" data-enhance>
                <label class="playlist-upgrade__label" for="targetPlaylist" data-i18n="forms.upgrade.title">Improve an existing playlist (optional)</label>
                <div class="playlist-upgrade__select-row">
                  <label class="playlist-upgrade__select-label" for="playlistSelect" data-i18n="forms.upgrade.selectLabel">Choose from your playlists</label>
                  <div class="playlist-upgrade__select-inline">
                    <select
                      id="playlistSelect"
                      class="playlist-upgrade__select model-bar__select"
                      aria-describedby="playlistSelectStatus"
                    >
                      <option value="" data-i18n="forms.upgrade.loading">Loading playlists‚Ä¶</option>
                    </select>
                    <button
                      type="button"
                      class="btn btn--ghost btn--compact playlist-upgrade__refresh"
                      id="refreshPlaylists"
                      title="Refresh playlists"
                      aria-label="Refresh playlist list"
                      data-i18n="forms.upgrade.refresh"
                      data-i18n-title="forms.upgrade.refresh"
                      data-i18n-aria-label="forms.upgrade.refresh"
                    >
                      Refresh
                    </button>
                  </div>
                  <p id="playlistSelectStatus" class="playlist-upgrade__hint status" data-select-status></p>
                </div>
                <input
                  id="targetPlaylist"
                  name="playlistId"
                  type="text"
                  class="playlist-upgrade__input"
                  placeholder="Paste a Spotify playlist link or ID"
                  data-i18n-placeholder="forms.upgrade.placeholder"
                  autocomplete="off"
                />
                <p class="playlist-upgrade__hint" data-i18n="forms.upgrade.help">
                  We&apos;ll keep the playlist and add fresh tracks from your prompt. Leave blank to create a brand-new playlist.
                </p>
              </div>
              <button type="submit" class="btn btn--primary" data-i18n="forms.custom.submit">Create Custom Playlist</button>
            </form>
            <div id="formStatus" class="status" role="status" aria-live="polite"></div>
          </section>

          <section class="panel panel--glass" aria-labelledby="genreTitle">
            <div class="panel__header">
              <h2 class="panel__title" id="genreTitle" data-i18n="genre.title">Organize liked songs by genre</h2>
              <p class="panel__description" data-i18n="genre.description">
                Build smart collections from every track you&apos;ve liked. We&apos;ll gather your saved songs, detect dominant styles, and shape ready-to-save playlists per genre.
              </p>
            </div>
            <div class="genre-actions">
              <button class="btn btn--primary" id="groupGenresButton" data-i18n="genre.cta">Group liked songs by genre</button>
              <p id="genreStatus" class="status" role="status" aria-live="polite"></p>
            </div>
            <div id="genreResults" class="genre-grid" aria-live="polite"></div>
          </section>

          <section class="panel panel--glass" aria-labelledby="resultsTitle">
            <div class="panel__header">
              <h2 class="panel__title" id="resultsTitle" data-i18n="results.title">Your generated playlists</h2>
              <p class="panel__description" data-i18n="results.description">
                Newly created Spotify playlists appear below. Press play inline or open them directly in Spotify to keep the vibe going.
              </p>
            </div>
            <div id="liveStatus" class="live-status" hidden>
              <div class="live-status__loader" role="status" aria-live="polite">
                <span class="loader__orb"></span>
                <span class="live-status__label" data-i18n="live.tuning">Tuning Gemini&apos;s frequency‚Ä¶</span>
              </div>
              <ul id="statusSteps" class="live-status__steps"></ul>
              <div class="ticker" id="liveTicker" aria-live="polite">
                <div class="ticker__inner" id="tickerInner"></div>
              </div>
            </div>
            <div id="results" class="playlist-grid" aria-live="polite"></div>
          </section>
        </main>
      </div>

      <div id="chatView" class="view" role="region" aria-labelledby="chatViewTitle" hidden>
        <header class="hero hero--compact">
          <div class="hero__content">
            <h1 class="hero__title" id="chatViewTitle" data-i18n="chat.hero.title">Brainstorm playlists in chat</h1>
            <p class="hero__subtitle" data-i18n="chat.hero.subtitle">
              Trade ideas with Gemini in a chat-style flow and capture ready-to-use tags and song snippets for your next playlist.
            </p>
          </div>
        </header>

        <main class="content chat-content">
          <section class="panel panel--glass chat-panel" aria-labelledby="chatPanelTitle">
            <div class="panel__header chat-panel__header">
              <h2 class="panel__title" id="chatPanelTitle" data-i18n="chat.panel.title">Chat with the model</h2>
              <p class="panel__description" data-i18n="chat.panel.description">
                Share the mood, references, or stories you want to translate into music. Gemini replies with insights and optional tags to power up your playlist.
              </p>
            </div>
            <div class="chat-log" id="chatLog" role="log" aria-live="polite">
              <div class="chat-message chat-message--assistant">
                <div class="chat-message__avatar" aria-hidden="true">‚ú®</div>
                <div class="chat-message__bubble">
                  <span class="chat-message__sender">Geminify</span>
                  <p class="chat-message__body" data-i18n="chat.initialMessage">Hey! Tell me the vibe, context, or inspiration you're exploring and I'll bring ideas, potential tags, and song examples.
                  </p>
                </div>
              </div>
            </div>
            <form id="chatForm" class="chat-form" novalidate autocomplete="off">
              <label class="sr-only" for="chatInput" data-i18n="chat.form.label">Message for the model</label>
              <div class="chat-form__field">
                <div class="chat-input-row">
                  <div class="chat-input-wrapper">
                    <textarea
                      id="chatInput"
                      name="message"
                      rows="1"
                      autocomplete="off"
                      autocapitalize="off"
                      autocorrect="off"
                      spellcheck="false"
                      placeholder="e.g. I want a cozy playlist with indie game lo-fi"
                      data-i18n-placeholder="chat.form.placeholder"
                      required
                      style="resize:none;overflow:hidden;min-height:40px;max-height:160px;"
                    ></textarea>
                    <button
                      type="button"
                      class="chat-upload-btn"
                      id="chatUploadToggle"
                      aria-haspopup="true"
                      aria-expanded="false"
                      title="Enviar op√ß√µes de contexto"
                      aria-label="Enviar op√ß√µes de contexto"
                      data-i18n-title="chat.actions.toggleUploads"
                      data-i18n-aria-label="chat.actions.toggleUploads"
                    >
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17 8l-5-5-5 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 3v12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <div class="chat-upload__dropdown" id="chatUploadDropdown" hidden>
                      <button
                        type="button"
                        class="btn btn--ghost chat-dropdown__item"
                        id="sendLikedSongs"
                        data-i18n="chat.actions.sendLikedSongs"
                      >
                        Enviar m√∫sicas curtidas
                      </button>
                      <button
                        type="button"
                        class="btn btn--ghost chat-dropdown__item"
                        id="chatOpenPlaylistModal"
                        data-i18n="chat.actions.updatePlaylist"
                      >
                        Atualizar playlist
                      </button>
                    </div>
                  </div>
                  <button
                    type="submit"
                    class="chat-send-button"
                    id="chatSendButton"
                    aria-label="Send message"
                    title="Send message"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
                <div class="chat-form__actions">
                  <div class="chat-form__primary">
                    <button type="button" class="btn btn--ghost" id="chatCreatePlaylistButton" data-i18n="chat.form.create">
                      Create playlist from chat
                    </button>
                  </div>
                  <button type="button" class="btn btn--ghost chat-reset" id="chatResetButton" data-i18n="chat.form.reset">
                    Reset chat &amp; tags
                  </button>
                </div>
              </div>
              <div class="chat-form__stFatus">
                <div id="chatStatus" class="status" role="status" aria-live="polite"></div>
                <p id="chatCreationStatus" class="status" role="status" aria-live="polite"></p>
              </div>
            </form>
          </section>

          <div class="tag-lane">
            <section class="panel panel--glass tag-panel" aria-labelledby="themeTagsTitle">
              <div class="tag-panel__header">
                <h3 class="tag-panel__title" id="themeTagsTitle" data-i18n="chat.tags.themeTitle">Vibes &amp; narratives</h3>
                <p class="tag-panel__description" data-i18n="chat.tags.themeDescription">Collect quick keywords for vibe, genre, or references.</p>
              </div>
              <div class="tag-list" id="themeTagList" data-empty>
                <p class="tag-empty" data-i18n="chat.tags.emptyTheme">No tags yet. Start chatting with the model!</p>
              </div>
            </section>

            <section class="panel panel--glass tag-panel" aria-labelledby="songTagsTitle">
              <div class="tag-panel__header">
                <h3 class="tag-panel__title" id="songTagsTitle" data-i18n="chat.tags.songTitle">Suggested songs</h3>
                <p class="tag-panel__description" data-i18n="chat.tags.songDescription">Quick examples to jump-start your playlist.</p>
              </div>
              <div class="tag-list" id="songTagList" data-empty>
                <p class="tag-empty" data-i18n="chat.tags.emptySong">When suggestions arrive, they‚Äôll show up here.</p>
              </div>
            </section>
          </div>
        </main>
      </div>

      <footer class="footer">
        <p data-i18n="footer.note">Built with ‚ù§Ô∏è using Spotify Web API and Google Gemini</p>
      </footer>
    </div>

    <!-- Modal: Playlist Context Selection -->
    <div class="modal" id="chatPlaylistModal" hidden aria-hidden="true">
      <div class="modal__backdrop" data-modal-close></div>
      
      <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="chatPlaylistModalTitle" tabindex="-1">
        <!-- Close Button -->
        <button
          type="button"
          class="modal__close"
          id="chatPlaylistModalClose"
          aria-label="Fechar"
          data-i18n-aria-label="chat.playlistModal.close"
        >
          √ó
        </button>

        <!-- Header -->
        <header class="modal__header">
          <h2 class="modal__title" id="chatPlaylistModalTitle" data-i18n="chat.playlistModal.title">
            Atualizar playlist com contexto
          </h2>
          <p class="modal__description" data-i18n="chat.playlistModal.description">
            Escolha uma playlist existente para enviar o contexto e receber sugest√µes focadas nela.
          </p>
        </header>

        <!-- Content -->
        <section class="modal__body">
          <div class="playlist-selector">
            <label 
              class="playlist-selector__label" 
              for="chatPlaylistSelect" 
              data-i18n="chat.playlistContext.label"
            >
              Enhance an existing playlist (optional)
            </label>
            
            <div class="playlist-selector__controls modal__controls">
              <select
                id="chatPlaylistSelect"
                class="playlist-selector__select"
                aria-describedby="chatPlaylistHint"
                disabled
              >
                <option value="" data-i18n="chat.playlistContext.loading">
                  Loading playlists‚Ä¶
                </option>
              </select>
              
              <button
                type="button"
                class="btn btn--ghost playlist-selector__refresh"
                id="chatRefreshPlaylists"
                data-i18n="chat.playlistContext.refresh"
              >
                Refresh
              </button>
            </div>
            
            <p
              id="chatPlaylistHint"
              class="playlist-selector__hint status"
              role="status"
              aria-live="polite"
              hidden
              aria-hidden="true"
            ></p>
          </div>
        </section>

        <!-- Footer Actions -->
        <footer class="modal__footer">
          <button 
            type="button" 
            class="btn btn--ghost" 
            id="chatPlaylistModalCancel" 
            data-i18n="chat.playlistModal.cancel"
          >
            Cancelar
          </button>
          <button 
            type="button" 
            class="btn btn--primary" 
            id="chatSendPlaylistContext" 
            data-i18n="chat.playlistModal.send"
          >
            Enviar playlist
          </button>
        </footer>
      </div>
    </div>

    <script src="/app.js" type="module"></script>
  </body>
</html>
